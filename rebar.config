%% -*- mode: erlang; erlang-indent-level: 2; indent-tabs-mode: nil -*-
%% ex: ts=2 sw=2 ft=erlang et

% Earlier versions lack, amongst other things, the gen_tcp:socket()
% type as an export
{require_min_otp_vsn, "18.3"}.

{erl_opts, [
  debug_info,
%  warnings_as_errors,
  warn_export_vars,
  warn_obsolete_guard,
  warn_unused_import,
  {warn_format, 1}
]}.

{cover_enabled, true}.
{eunit_opts, [verbose, {report, {eunit_surefire, [{dir, "."}]}}]}.
{deps, [
  {snappy, ".*", {git, "https://github.com/fdmanana/snappy-erlang-nif.git", {ref, "76417d"}}},
  {lz4, ".*", {git, "https://github.com/szktty/erlang-lz4.git", {tag, "0.2.2"}}},
  {semver, ".*", {git, "https://github.com/nebularis/semver.git", {ref, "c7d509"}}},
  {uuid, ".*", {git, "https://github.com/okeuday/uuid.git", {tag, "v1.4.1"}}},
  {re2, ".*", {git, "https://github.com/tuncer/re2.git", {tag, "v1.4.0"}}}
]}.

{overrides, [
  {override, re2, [
    {provider_hooks, [{post, [{compile, {pc, compile}}, {clean, {pc, clean}}]}]},
    {port_env, [
      {"DRV_CFLAGS",  "$DRV_CFLAGS -O3 -Wall -Wextra -I c_src/re2 -std=c++11"},
      {"DRV_LDFLAGS", "$DRV_LDFLAGS c_src/re2/obj/libre2.a"},
      {"(linux|freebsd|solaris)", "LDFLAGS", "$LDFLAGS -lstdc++"}
    ]}
  ]}
]}.

{dialyzer, [
  {warnings, [error_handling, underspecs, unknown, unmatched_returns]},
  {base_plt_apps,
   [
    kernel, stdlib, ssl, compiler, erts, crypto, public_key, hipe,
    inets, asn1, mnesia, runtime_tools, syntax_tools
   ]
  },
  {plt_apps, top_level_deps}
]}.

{ct_opts, [
  {logdir, "_build/test/ct_logs"},
  {config, "test/test.config"}
]}.
